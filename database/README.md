## Database

### 인덱스

Index란 테이블을 처음부터 끝까지 검색하는 방법이 아닌 인덱스를 검색하여 해당 자료의 테이블을 액세스 하는 자료구조이다. 대량의 데이터를 다룰 때 데이터 검색 속도를 크게 향상시킨다.

정렬된 상태를 유지하는 것이기 때문에 원하는 자료를 조회하는 것은 빠르지만 새로운 값을 추가하거나 삭제, 수정하는 쿼리는 느리다.

#### 인덱스 자료 구조

B+tree

- 자식 노드가 2개 이상인 B-tree를 개선시킨 자료구조로 Linked List로 연결하여 순차 검색이 용이하다. 해시 테이블보다 시간 복잡도가 높지만 일반적으로 많이 사용된다.

해시 테이블

- 컬럼의 값으로 생성된 해시를 기반으로 인덱스를 구현한다. 시간 복잡도가 낮아 검색이 매우 빠르지만 부등호와 같은 연속적인 데이터를 위한 순차 검색이 불가능하여 사용에 부적합하다.

### 트리거

트리거는 특정 테이블에 대한 이벤트에 반응해 insert, delete, update가 수행되었을 때 데이터베이스에서 자동으로 동작하도록 작성된 프로그램이다.
사용자가 직접 호출하는 것이 아니라 데이터베이스에서 자동적으로 호출한다는 것이 큰 특징이다.

### 트랜잭션

트랜잭션은 데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산을 의미한다.

```
사용자 A가 계좌에서 만원을 B에게 송금한다.

1. 사용자 A의 계좌에서 만 원을 차감한다. -> update로 사용자 A 잔고 변경
2. 사용자 B의 계좌에 만 원을 추가한다. -> update로 사용자 B 잔고 변경

여기에서 작업의 단위: 출금, 입금
-> 위의 작업을 통틀어 하나의 트랜잭션이라고 할 수 있다.
두 쿼리문이 모두 성공해야 하나의 작업이 완료되었다고 할 수 있다.
```

#### 트랜잭션의 특징

- 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적인 단위이다.
- 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업 단위이다.
- 하나의 트랜잭션은 Commit 되거나 Rollback 되어야 한다.

#### 트랜잭션의 성질(ACID)

Atomicity(원자성)

- all or nothing -> 모두 반영되거나 전혀 반영되지 않아야 한다.
- 트랜잭션 내의 모든 명령은 반드시 완벽하게 수행되어야 하며, 모두 완벽히 수행되면 commit, 그러지 않으면 rollback으로 모든 작업을 취소해야 한다.

consistency(일관성)

- 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변한다.
- 시스템이 가지고 있는 고정 요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 동일해야 한다.

isolation(독립성)

- 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션 연산이 끼어들 수 없다.
- 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.
- isolation 성질을 보장할 수 있는 가장 쉬운 방법은 모든 트랜잭션을 순차적으로 수행하는 것이다. 단, 병렬적 수행의 장점을 얻기 위해 DBMS는 병렬적으로 수행하면서도 일렬 수행과 같은 결과를 보장할 수 있는 방식을 제공한다.

durability(영속성)

- 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 한다.

#### 트랜잭션을 사용할 때 주의할 점

- 트랜잭션은 필요한 최소의 코드에만 적용해야 한다.
  - 여러 개의 트랜잭션으로 쪼개서 트랜잭션의 범위를 최소화해야 한다.
- 트랜잭션의 성질 중 하나인 격리성으로 인해 Dirty Read, Non-Repeatable Read, Phantom Read 3가지의 문제가 발생할 수 있다.

Dirty Read: 다른 트랜잭션에 의해 수정되었지만 아직 커밋되지 않은 데이터를 읽는 것을 의미한다.
Non-Repeatable Read: 하나의 트랜잭션에서 Key를 가진 Row를 두 번 읽었지만 그 사이 값이 변경되거나 삭제되어 결과가 다르게 나타나는 현상을 의미한다.
Phantom Read: 하나의 트랜잭션에서 같은 쿼리를 두 번 수행하는데 첫 번째 쿼리에서 없던 유령 레코드가 두 번째 쿼리에서 나타나는 현상을 의미한다.

#### 지정할 수 있는 격리성 수준

Read Uncommitted < Read Committed < Repeatable Read < Serializable Read
